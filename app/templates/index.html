<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Material Entry Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Material Entry Form</h2>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <form method="POST">
            {{ form.csrf_token }}
            
            <div class="row">
                <div class="col-md-4 mb-3">
                    {{ form.date.label(class="form-label") }}
                    {{ form.date(class="form-control", type="text") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.vehicle_number.label(class="form-label") }}
                    {{ form.vehicle_number(class="form-control") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.supplier_name.label(class="form-label") }}
                    {{ form.supplier_name(class="form-control") }}
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4 mb-3">
                    {{ form.challan_bill_no.label(class="form-label") }}
                    {{ form.challan_bill_no(class="form-control") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.material.label(class="form-label") }}
                    <div class="input-group">
                        {{ form.material(class="form-select", id="material-select") }}
                        <input type="text" class="form-control" id="material-search" placeholder="Search Material">
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.unit.label(class="form-label") }}
                    <div class="input-group">
                        {{ form.unit(class="form-select", id="unit-select") }}
                        <input type="text" class="form-control" id="unit-search" placeholder="Search Unit">
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4 mb-3">
                    {{ form.quantity.label(class="form-label") }}
                    {{ form.quantity(class="form-control") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.basic_rate.label(class="form-label") }}
                    {{ form.basic_rate(class="form-control") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.amount_without_gst.label(class="form-label") }}
                    {{ form.amount_without_gst(class="form-control") }}
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4 mb-3">
                    {{ form.sgst.label(class="form-label") }}
                    {{ form.sgst(class="form-select", id="sgst-select") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.cgst.label(class="form-label") }}
                    {{ form.cgst(class="form-select", id="cgst-select") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.igst.label(class="form-label") }}
                    {{ form.igst(class="form-select", id="igst-select") }}
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4 mb-3">
                    {{ form.cess.label(class="form-label") }}
                    {{ form.cess(class="form-control") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.tds.label(class="form-label") }}
                    {{ form.tds(class="form-select") }}
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.transportation_charges.label(class="form-label") }}
                    {{ form.transportation_charges(class="form-control") }}
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4 mb-3">
                    {{ form.loading_unloading_gst.label(class="form-label") }}
                    <div>
                        {% for subfield in form.loading_unloading_gst %}
                            <div class="form-check form-check-inline">
                                {{ subfield(class="form-check-input") }}
                                {{ subfield.label(class="form-check-label") }}
                            </div>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    {{ form.loading_unloading_amount.label(class="form-label") }}
                    {{ form.loading_unloading_amount(class="form-control") }}
                </div>
            </div>
            
            {{ form.submit(class="btn btn-primary") }}
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Material Search Functionality
        $('#material-search').on('input', function() {
            let searchTerm = $(this).val().toLowerCase();
            $('#material-select option').each(function() {
                let optionText = $(this).text().toLowerCase();
                $(this).toggle(optionText.includes(searchTerm));
            });
        });

        // Unit Search Functionality
        $('#unit-search').on('input', function() {
            let searchTerm = $(this).val().toLowerCase();
            $('#unit-select option').each(function() {
                let optionText = $(this).text().toLowerCase();
                $(this).toggle(optionText.includes(searchTerm));
            });
        });

        // Tax Dropdown Mutual Exclusivity 
        function setupTaxDropdown(selectId, otherIds) {
            $(`#${selectId}`).on('change', function() {
                let selectedValue = $(this).val();
                otherIds.forEach(otherId => {
                    $(`#${otherId} option`).each(function() {
                        $(this).prop('selected', false);
                    });
                });
            });
        }

        setupTaxDropdown('sgst-select', ['igst-select']);
        setupTaxDropdown('cgst-select', ['igst-select']);
        setupTaxDropdown('igst-select', ['sgst-select', 'cgst-select']);
    </script>
</body>
</html>